[buildout]
extends = buildout.cfg
parts +=
    xmltest
    pep8
    pyflakes
    coverage-run
    coverage-harvest
    violations

[xmltest]
<= test
recipe = collective.xmltestreport
defaults = ['--tests-pattern', '^f?tests$', '-vv', '--xml']

[scripts]
recipe = zc.recipe.egg
eggs =
    ${app:eggs}
    coverage

[pep8]
recipe = zc.recipe.egg
eggs = pep8

[pyflakes]
recipe = zc.recipe.egg
eggs =
    pyflakes
scripts = pyflakes
entry-points = pyflakes=pyflakes.scripts.pyflakes:main

[violations]
recipe = collective.recipe.cmd
dummy = ${pep8:eggs} ${pyflakes:eggs} # mark dependencies
cmds =
    ${buildout:directory}/bin/pep8 src | perl -ple "s/:[0-9]+: [WE]([0-9]+)/: [W]/;s|^|buildout/|" > violations.txt
    ${buildout:directory}/bin/pyflakes src | perl -ple "s/:([0-9]+): /:\1: [E] /;s|^|buildout/|" >> violations.txt
    find src/|grep py$|xargs -n2 grep -n except:|perl -pe "s/(:[0-9]+:).*/\1 [E] Empty except/;s/^/buildout\//" >> violations.txt
on_update = true
on_install = true

[coverage-run]
<= scripts
entry-points =
    coveragetest=coverage.cmdline:main
arguments = [
        'run',
        '--include=*bioport_repository*,'
        '*bioport*,*biodes*,*gerbrandyutils*',
        '--omit=*tests*',
        ] + sys.argv[1:]

[coverage-harvest]
<= scripts
entry-points =
    coveragexml=coverage.cmdline:main
arguments = ['xml']


[versions]
coverage = 3.4
plone.recipe.command = 1.1
pep8 = 0.6.0
pyflakes = 0.4.0
elementtree = 1.2.7-20070827-preview
collective.xmltestreport = 1.0b3
